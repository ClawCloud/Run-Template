# Start from official n8n image (Alpine Linux)
FROM n8nio/n8n:latest

# Switch to root to install system packages
USER root

# Install FFmpeg + Python + yt-dlp
RUN apk update && \
    apk add --no-cache \
        ffmpeg \
        python3 \
        py3-pip && \
    pip3 install --no-cache-dir yt-dlp

# Go back to n8n user (security)
USER node

# Start n8n
CMD ["n8n"]
